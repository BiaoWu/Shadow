apply from: "../sample-normal-app/build.gradle"

android {
    defaultConfig {
        applicationId project.SAMPLE_HOST_APP_APPLICATION_ID
    }
}

def createDuplicateApkTask(buildType) {
    def apkDir = file("${getBuildDir()}/outputs/apk/$buildType")

    return tasks.create("duplicate${buildType.capitalize()}ApkTask", Copy) {
        group = 'build'
        description = "复制一个sample-plugin-app-${buildType}.apk用于测试目的"
        from(apkDir) {
            include("sample-plugin-app-${buildType}.apk")
            rename { "sample-plugin-app-${buildType}2.apk" }
        }
        into(apkDir)

    }.dependsOn(":sample-plugin-app:assemble${buildType.capitalize()}")
}

tasks.whenTaskAdded { task ->
    if (task.name == "assembleDebug") {
        def createTask = createDuplicateApkTask('debug')
        task.finalizedBy(createTask)
    }
    if (task.name == "assembleRelease") {
        def createTask = createDuplicateApkTask('release')
        task.finalizedBy(createTask)
    }
}